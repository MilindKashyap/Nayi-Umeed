{% extends "base.html" %}
{% load cloudinary_tags %}
{% block title %}My Devices - Nayi Umeed{% endblock %}
{% block content %}
<div style="margin-bottom: var(--spacing-2xl);">
  <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-lg);">
    <div>
      <h1 style="margin-bottom: var(--spacing-sm);">My Devices</h1>
      <p style="color: var(--gray-600); font-size: var(--font-size-lg);">Track your donated devices and their status</p>
    </div>
    <a href="{% url 'devices:create' %}" class="btn btn-success">
      + Add New Device
    </a>
  </div>
</div>

{% if devices %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: var(--spacing-xl);">
    {% for device in devices %}
      <div class="card" style="padding: 0; overflow: hidden;">
        {% if device.images.first %}
          <div style="width: 100%; height: 180px; overflow: hidden; background: var(--gray-100); display: flex; align-items: center; justify-content: center;">
            <img src="{{ device.images.first|cloudinary_url_by_device }}" alt="{{ device.title }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center; display: block;" loading="lazy">
          </div>
        {% else %}
          <div style="width: 100%; height: 180px; background: var(--gray-100); display: flex; align-items: center; justify-content: center; color: var(--gray-400);">
            No Image
          </div>
        {% endif %}
        
        <div style="padding: var(--spacing-lg);">
          <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">{{ device.title }}</h3>
          
          <div style="margin-bottom: var(--spacing-md);">
            <div style="margin-bottom: var(--spacing-xs);">
              <span class="badge badge-primary" style="margin-right: var(--spacing-xs);">{{ device.get_category_display }}</span>
              <span class="badge 
                {% if device.status == 'allocated' %}badge-success
                {% elif device.status == 'certified' or device.status == 'listed' %}badge-primary
                {% elif device.status == 'under_repair' or device.status == 'under_inspection' %}badge-warning
                {% else %}badge-secondary{% endif %}">
                {{ device.get_status_display }}
              </span>
            </div>
            <div style="font-size: var(--font-size-sm); color: var(--gray-600); margin-bottom: var(--spacing-xs);">
              <strong>ID:</strong> {{ device.listing_id }}
            </div>
            {% if device.admin_approval_status != 'approved' %}
              <div style="margin-top: var(--spacing-xs);">
                <span class="badge 
                  {% if device.admin_approval_status == 'pending' %}badge-warning
                  {% elif device.admin_approval_status == 'rejected' %}badge-error
                  {% elif device.admin_approval_status == 'on_hold' %}badge-warning
                  {% endif %}">
                  Approval: {{ device.get_admin_approval_status_display }}
                </span>
              </div>
            {% endif %}
          </div>
          
          <a href="{% url 'devices:detail' device.pk %}" class="btn btn-primary btn-full" style="text-decoration: none; text-align: center;">
            View Details
          </a>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card text-center" style="padding: var(--spacing-3xl);">
    <h2 style="margin-bottom: var(--spacing-md);">No Devices Yet</h2>
    <p style="color: var(--gray-600); margin-bottom: var(--spacing-xl);">
      Start by donating a medical device to help those in need.
    </p>
    <a href="{% url 'devices:create' %}" class="btn btn-success">
      Submit Your First Device
    </a>
  </div>
{% endif %}
{% endblock %}
