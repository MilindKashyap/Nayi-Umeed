{% extends "base.html" %}
{% block content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-semibold text-slate-900">Logistics Tasks</h1>
  <div class="flex gap-2">
    <a href="?type=pickup" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm">Pickups</a>
    <a href="?type=delivery" class="px-3 py-1 bg-green-100 text-green-700 rounded text-sm">Deliveries</a>
    <a href="{% url 'logistics:task_list' %}" class="px-3 py-1 bg-slate-100 text-slate-700 rounded text-sm">All</a>
  </div>
</div>

<div class="grid gap-4">
  {% for task in tasks %}
    <a href="{% url 'logistics:task_detail' task.pk %}" class="block bg-white shadow rounded-lg p-4 hover:shadow-md transition">
      <div class="flex justify-between items-start">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-1 text-xs font-semibold rounded
              {% if task.task_type == 'pickup' %}bg-blue-100 text-blue-700{% else %}bg-green-100 text-green-700{% endif %}">
              {{ task.get_task_type_display }}
            </span>
            <span class="px-2 py-1 text-xs font-semibold rounded
              {% if task.status == 'assigned' %}bg-yellow-100 text-yellow-700
              {% elif task.status == 'picked_up' %}bg-blue-100 text-blue-700
              {% elif task.status == 'delivered' %}bg-emerald-100 text-emerald-700
              {% else %}bg-slate-100 text-slate-700{% endif %}">
              {{ task.get_status_display }}
            </span>
          </div>
          
          {% if task.device %}
            <div class="font-semibold text-slate-900">{{ task.device.title }}</div>
            <div class="text-sm text-slate-600">Device ID: {{ task.device.listing_id }}</div>
          {% elif task.order %}
            <div class="font-semibold text-slate-900">Order #{{ task.order.id }}</div>
            <div class="text-sm text-slate-600">{{ task.order.listing.device.title }}</div>
          {% endif %}
          
          <div class="mt-2 text-sm text-slate-600">
            <div class="font-medium">Address:</div>
            <div>{{ task.display_address|truncatewords:15 }}</div>
          </div>
          
          {% if task.assigned_to %}
            <div class="mt-1 text-xs text-slate-500">Assigned to: {{ task.assigned_to.get_full_name|default:task.assigned_to.username }}</div>
          {% endif %}
        </div>
        
        <div class="text-right text-xs text-slate-500">
          <div>Assigned: {{ task.assigned_at|date:"M d, Y" }}</div>
          {% if task.picked_up_at %}
            <div class="text-blue-600">Picked: {{ task.picked_up_at|date:"M d" }}</div>
          {% endif %}
          {% if task.delivered_at %}
            <div class="text-emerald-600">Delivered: {{ task.delivered_at|date:"M d" }}</div>
          {% endif %}
        </div>
      </div>
    </a>
  {% empty %}
    <div class="bg-white shadow rounded-lg p-8 text-center text-slate-600">
      <p class="text-lg">No logistics tasks found.</p>
      <p class="text-sm mt-2">Tasks will appear here when devices need pickup or orders need delivery.</p>
    </div>
  {% endfor %}
</div>
{% endblock %}

